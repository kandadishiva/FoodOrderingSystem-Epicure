{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>
    {% block title %}
    {% endblock title %}
  </title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.g{% static '.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Amatic+SC:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{% static '/assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static '/assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static '/assets/vendor/aos/aos.css' %}" rel="stylesheet">
  <link href="{% static '/assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
  <link href="{% static '/assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="{% static '/assets/css/main.css' %}" rel="stylesheet">

<!-- Font Awesome CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<!-- Font Awesome JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" defer></script>


</head>

<body>
  {% block content %}
  {% endblock content %}

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">
    <div class="container d-flex align-items-center justify-content-between">

      <a class="logo d-flex align-items-center me-auto me-lg-0"
      {% if request.user.is_authenticated %}
        href="/home"
      {% else %}
        href="/"
      {% endif %}
      >
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!--<img src="{% static 'images/avatar.png' %}" alt=""> -->
        <h1>Epicure<span></span></h1>
      </a>

      <nav id="navbar" class="navbar">
        <ul>
          {% block navbar %}
          {% endblock navbar %}
        </ul>
      </nav><!-- .navbar -->

        {% if request.user.is_authenticated %}
        <!--<a class="btn-book-a-table" href="/validate/logout/">Logout</a>-->
        <div class="dropdown" style="display:flex; gap :20px;">
          {% block AddFood %}
          {% endblock AddFood %}
          <button type="button" class="btn-book-a-table" id="popcart" data-container="body" data-toggle="popover" data-placement="bottom" data-html="true" style="border: none;"><i class="fa-solid fa-cart-shopping fa-fade"></i> Cart (<span id="cart">0</span>)</button>

          <a href="#" class="logo d-flex align-items-center me-auto me-lg-0" id="dropdownMenuButton1" data-bs-toggle="dropdown">
            
            <img src="{% static 'images/avatar.png' %}" alt="">
            
          </a>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            <li><a class="dropdown-item" href="#"><img src="{% static 'images/login.png' %}" alt="" height=25 width=25>  Profile</a></li>
            <li><a class="dropdown-item" href="#"><img src="{% static 'images/orders.png' %}" alt="" height=25 width=25>  My Orders</a></li>
            <li><a class="dropdown-item" href="/newrestaurant"><img src="{% static 'images/list.png' %}" alt="" height=25 width=25>  Start a Restaurant</a></li>
            <li><a class="dropdown-item" href="#"><img src="{% static 'images/setting.png' %}" alt="" height=25 width=25>  Settings</a></li>
            <li><a class="dropdown-item" href="/validate/logout/"><img src="{% static 'images/log.png' %}" alt="" height=25 width=25>  Logout</a></li>
          </ul>
        </div>  
        
        {% else %}
        <a class="btn-book-a-table" href="/validate/login/">Login/Signup</a>
        {% endif %}

      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>

    </div>
  </header><!-- End Header -->

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="hero d-flex align-items-center section-bg">
    {% block hero %}
    {% endblock hero %}
  </section><!-- End Hero Section -->

  <main id="main">

    <!-- ======= Registeration Section ======= -->
    {% block formSection%}
    {% endblock formSection%}
    

    <!-- ======= Contact Section ======= -->
    <section id="contact" class="contact">
      <div class="container" data-aos="fade-up">

        <div class="section-header">
          <h2>Contact</h2>
          <p>Need Help? <span>Contact Us</span></p>
        </div>

        <div class="mb-3">
          <iframe style="border:0; width: 100%; height: 350px;" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3808.9147452434554!2d78.61299184061008!3d17.31966211365528!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bcba15d10db7815%3A0x8aea74cd4382be18!2sMidhani%20Colony%20Park!5e0!3m2!1sen!2sin!4v1684153154455!5m2!1sen!2sin" frameborder="0" allowfullscreen></iframe>
                        </div><!-- End Google Maps -->

        <div class="row gy-4">

          <div class="col-md-6">
            <div class="info-item  d-flex align-items-center">
              <i class="icon bi bi-map flex-shrink-0"></i>
              <div>
                <h3>Our Address</h3>
                <p>Hyderabad, Telangana, India</p>
              </div>
            </div>
          </div><!-- End Info Item -->

          <div class="col-md-6">
            <div class="info-item d-flex align-items-center">
              <i class="icon bi bi-envelope flex-shrink-0"></i>
              <div>
                <h3>Email Us</h3>
                <p>kandadishiva8109@gmail.com</p>
              </div>
            </div>
          </div><!-- End Info Item -->

          <div class="col-md-6">
            <div class="info-item  d-flex align-items-center">
              <i class="icon bi bi-telephone flex-shrink-0"></i>
              <div>
                <h3>Call Us</h3>
                <p>+919848639990</p>
              </div>
            </div>
          </div><!-- End Info Item -->

          <div class="col-md-6">
            <div class="info-item  d-flex align-items-center">
              <i class="icon bi bi-share flex-shrink-0"></i>
              <div>
                <h3>Opening Hours</h3>
                <div><strong>Mon-Sat:</strong> 8AM - 8PM;
                  <strong>Sunday:</strong> Closed
                </div>
              </div>
            </div>
          </div><!-- End Info Item -->

        </div>

        <form action="/contact" method="post" role="form" class="php-email-form p-3 p-md-4">{% csrf_token %}
          <div class="row">
            <div class="col-xl-6 form-group">
              <input type="text" name="name" class="form-control" id="name" placeholder="Your Name" required>
            </div>
            <div class="col-xl-6 form-group">
              <input type="email" class="form-control" name="email" id="email" placeholder="Your Email" required
              {% if request.user.is_authenticated %}
              value="{{ request.user.email }}"
              {% endif %}
              
              >
            </div>
          </div>
          <div class="form-group">
            <input type="text" class="form-control" name="subject" id="subject" placeholder="Subject" required>
          </div>
          <div class="form-group">
            <textarea class="form-control" name="message" rows="5" placeholder="Message" required></textarea>
          </div>
          <div class="my-3">
            <div class="loading">Loading</div>
            <div class="error-message"></div>
            <div class="sent-message">Your message has been sent. Thank you!</div>
          </div>
          <div class="text-center"><button type="submit">Send Message</button></div>
        </form><!--End Contact Form -->

      </div>
    </section><!-- End Contact Section -->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">

    <div class="container">
      <div class="row gy-3">
        <div class="col-lg-3 col-md-6 d-flex">
          <i class="bi bi-geo-alt icon"></i>
          <div>
            <h4>Address</h4>
            <p>
              Hyderabad <br>
              Telangana-501505 India<br>
            </p>
          </div>

        </div>

        <div class="col-lg-3 col-md-6 footer-links d-flex">
          <i class="bi bi-telephone icon"></i>
          <div>
            <h4>Contact</h4>
            <p>
              <strong>Phone:</strong> +191 984 863 9990<br>
              <strong>Email:</strong> kandadishiva8109@gmail.com<br>
            </p>
          </div>
        </div>

        <div class="col-lg-3 col-md-6 footer-links d-flex">
          <i class="bi bi-clock icon"></i>
          <div>
            <h4>Opening Hours</h4>
            <p>
              <strong>Mon-Sat: 8AM</strong> - 8PM<br>
              Sunday: Closed
            </p>
          </div>
        </div>

        <div class="col-lg-3 col-md-6 footer-links">
          <h4>Follow Us</h4>
          <div class="social-links d-flex">
            <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
            <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
            <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
            <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>

      </div>
    </div>

    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>Epicure</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        
        Designed by <a href="#">K Shiva Prasad Reddy</a>
      </div>
    </div>

  </footer><!-- End Footer -->
  <!-- End Footer -->

  <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="{% static '/assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static '/assets/vendor/aos/aos.js' %}"></script>
  <script src="{% static '/assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
  <script src="{% static '/assets/vendor/purecounter/purecounter_vanilla.js' %}"></script>
  <script src="{% static '/assets/vendor/swiper/swiper-bundle.min.js' %}"></script>
  <script src="{% static '/assets/vendor/php-email-form/validate.js' %}"></script>

  <!-- Template Main JS File -->
  <script src="{% static '/assets/js/main.js' %}"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>


  <script>
  
    //find pout the card from local storage
  
    if (localStorage.getItem('cart') == null) {
        var cart = {};
    } else {
        cart = JSON.parse(localStorage.getItem('cart'));
        updateCart(cart);
  
    }
    // add or increment code
  
    // $('.cart').click(function() {
    $('.divpr').on('click', 'button.cart', function() {
        var idstr = this.id.toString();
        console.log(idstr)
        console.log ("we are inside cart click");
  
        if (cart[idstr] != undefined) {
            qty = cart[idstr][0] + 1;
  
        } else {
            qty = 1;
            console.log('we are  inside else');
            console.log('name'+idstr);
            name = document.getElementById('name' + idstr).innerHTML;
            
            price = document.getElementById('price' + idstr).innerHTML;
            cart[idstr] = [qty, name, price];
            
        }
        updateCart(cart);
  
        localStorage.setItem('cart', JSON.stringify(cart));
        document.getElementById('cart').innerHTML = Object.keys(cart).length;
        console.log( Object.keys(cart).length)
        document.getElementById("popcart").click();
    });
    // add pop over to cart
  
    $('#popcart').popover();
  
    updatePopover(cart);
    function updatePopover(cart) {
  
        
        console.log('we are  inside update popover');
        
        var popStr = "";
        var popStr = popStr + "<h5> Cart Items </h5> <div class='mx-2 my-2'>";
        var i = 1;
        var total=0;
        for (var item in cart) {
            var price1 =cart[item][2].split(":")[1]
            var price2=parseFloat(price1)
            var price3=price2*parseFloat(cart[item][0])
            total=total+price3
            popStr = popStr + i + ". ";
            popStr = popStr + document.getElementById('name' + item).innerHTML.slice(0, 19) + "..."+cart[item][0] + "Qty"  +"..."+"Rs:"+price3+ '<br>';
            i = i + 1;
        }
        popStr=popStr+"Total Price: "+total+'<br>';
        popStr = popStr + "</div> <span id='clearCartButton' class='btn btn-danger mx-2'>Clear Cart</span> <a href='/BillingPage' class='btn btn-primary mx-2'>Pay</a>";
        
        document.getElementById('popcart').setAttribute('data-content', popStr);
        if (Object.keys(cart).length > 0) {
          $('#popcart').popover('show');
          document.getElementById("popcart").click();
        }
        document.addEventListener('click', function(event) {
          if (event.target && event.target.id === 'clearCartButton') {
            clearCart();
          }
        });
    }
    
  
    function clearCart() {
        cart = JSON.parse(localStorage.getItem('cart'));
        for (var item in cart) {
          document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-danger cart btn-sm mt-0" style="background-color: #ce1212; color: white; border-radius: 10px;border:none;padding : 10px; width:150px">AddToCart <i class="fa-solid fa-cart-shopping"></i></button>'
        }
        localStorage.clear();
        cart = {};
        updateCart(cart);
        
       let clear= document.getElementById("popcart").click();
       document.getElementById("popcart").click();
      
    }
  
    function updateCart(cart) {
        var sum = 0;
        for (var item in cart) {
            sum = sum + cart[item][0];
            document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "'class='btn btn-success minus'>-</button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-success plus'> + </button>";
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        document.getElementById('cart').innerHTML = sum;
        console.log(cart);
        updatePopover(cart);
        document.getElementById("popcart").click();
    }
  
    //if plus or minus button is clicked change the cart as well as the display value
    $('.divpr').on("click", "button.minus", function() {
  
        a = this.id.slice(7, );
        cart['pr' + a][0] = cart['pr' + a][0] - 1;
        cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
        document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
        updateCart(cart);
        
  
    })
  
  
    $('.divpr').on("click", "button.plus", function() {
  
        a = this.id.slice(6, );
        cart['pr' + a][0] = cart['pr' + a][0] + 1;
  
        document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
        updateCart(cart);
        
  
    })
  </script>

</body>

</html>